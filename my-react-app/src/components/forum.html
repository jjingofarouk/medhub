<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Forum</title>
    <style>/* General Styles */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
            color: #333;
        }
        
        /* Header */
        header {
            background-color: #2e5668;
            color: #fff;
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        
        /* Sidebar */
        .sidebar {
            float: left;
            width: 100%;
            max-width: 240px;
            background-color: #e9ecef;
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
        }
        
        .sidebar a {
            display: block;
            padding: 10px;
            color: #333;
            text-decoration: none;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        
        .sidebar a:hover {
            background-color: #d6d9db;
        }
        
        .sidebar .active {
            background-color: #2e5668;
            color: #fff;
        }
        
        /* Main Content */
        main {
            margin-left: auto;
            margin-right: auto;
            padding: 20px;
            max-width: 1000px;
        }
        
        /* Button Styles */
        .btn-primary {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary:hover {
            background-color: #0056b3;
        }
        
        /* Forum Threads */
        .forum-threads ul {
            list-style-type: none;
            padding: 0;
        }
        
        .forum-threads li {
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        .forum-threads a {
            color: #007bff;
            text-decoration: none;
        }
        
        .forum-threads a:hover {
            text-decoration: underline;
        }
        
        .forum-threads p {
            font-size: 0.875em;
            color: #666;
        }
        
        /* Live Chat */
        #chat-button {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        #chat-box {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            position: absolute;
            bottom: 60px;
            right: 20px;
            width: 300px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        #chat-messages {
            padding: 10px;
        }
        
        #chat-input {
            width: calc(100% - 90px);
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            margin-right: 10px;
        }
        
        #send-message {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        /* User Badges */
        .user-badges ul {
            list-style-type: none;
            padding: 0;
        }
        
        .user-badges li {
            display: inline-block;
            margin: 10px;
            text-align: center;
        }
        
        .badge-icon {
            width: 50px;
            height: 50px;
        }
        
        /* User Polls and Surveys */
        .user-polls ul {
            list-style-type: none;
            padding: 0;
        }
        
        .user-polls li {
            margin-bottom: 20px;
        }
        
        .user-polls form {
            margin-top: 10px;
        }
        
        /* Threaded Replies */
        .threaded-replies li {
            margin-bottom: 20px;
        }
        
        .reply-form {
            margin-top: 10px;
        }
        
        .btn-reply {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        /* Forum Analytics Dashboard */
        .forum-analytics .analytics-dashboard {
            display: flex;
            flex-wrap: wrap;
        }
        
        .forum-analytics .stat {
            flex: 1;
            min-width: 150px;
            padding: 10px;
            margin: 10px;
            background-color: #fff;
            border-radius: 4px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        }
        
        /* Event Calendar */
        .event-calendar {
            margin-top: 20px;
        }
        
        /* User Profiles with Activity Feed */
        .user-profile {
            margin-top: 20px;
        }
        
        .user-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
        }
        
        .user-profile ul {
            list-style-type: none;
            padding: 0;
        }
        
        .user-profile li {
            margin-bottom: 10px;
        }
        
        /* Interactive Forum Widgets */
        .trending-topics ul, .active-threads ul {
            list-style-type: none;
            padding: 0;
        }
        
        .trending-topics li, .active-threads li {
            margin-bottom: 10px;
        }
        
        /* Rich Text Editor */
        .post-editor textarea {
            width: 100%;
            height: 150px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        /* User Settings */
        .user-settings form {
            margin-top: 20px;
        }
        
        .user-settings select, .user-settings button {
            margin-top: 10px;
        }
        
        /* Footer */
        footer {
            background-color: #2e5668;
            color: #fff;
            padding: 15px;
            text-align: center;
            clear: both;
        }
        
        .footer-links {
            margin: 0;
            padding: 0;
            list-style: none;
        }
        
        .footer-links a {
            color: #fff;
            text-decoration: none;
            margin: 0 10px;
        }
        
        .footer-links a:hover {
            text-decoration: underline;
        }
        
        /* Responsive Styles */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                float: none;
                padding: 10px;
            }
        
            .sidebar a {
                font-size: 0.9em;
            }
        
            main {
                margin-left: 0;
            }
        
            #chat-box {
                width: calc(100% - 20px);
                bottom: 10px;
                right: 10px;
            }
        
            .user-avatar {
                width: 80px;
                height: 80px;
            }
        }
        
        @media (max-width: 480px) {
            header h1 {
                font-size: 1.2em;
            }
        
            .sidebar a {
                font-size: 0.8em;
            }
        
            .btn-primary {
                padding: 8px 16px;
            }
        
            #chat-input {
                width: calc(100% - 80px);
            }
        }
        </style>
</head>
<body>
    <header>
        <h1>MedHub Forum</h1>
    </header>

    <div class="sidebar">
        <a href="{{ url_for('bp.index') }}"><h2>MedHub</h2></a>
        <a href="{{ url_for('bp.manage_appointments') }}">Manage Appointments</a>
        <a href="{{ url_for('bp.book_appointment') }}">Book Appointment</a>
        <a href="{{ url_for('bp.rebook_appointment') }}">ReBook Appointment</a>
        <a href="{{ url_for('bp.cancel_appointment') }}">Cancel Appointment</a>
        <a href="{{ url_for('bp.view_doctor_availability') }}">View Doctor Availability</a>
        <a href="{{ url_for('bp.edit_availability') }}" class="active">Edit Availability</a>
        <a href="{{ url_for('bp.consultations') }}">Start Consultation</a>
        <a href="{{ url_for('bp.view_medical_history') }}">View Medical History</a>
        <a href="{{ url_for('bp.local_health_directory') }}">Local Health Directory</a>
    </div>

    <main>
        <h1>Community Forum</h1>
        
        <!-- New Post Link -->
        <a href="{{ url_for('bp.new_post') }}" class="btn-primary">New Post</a>

        <!-- Forum Threads -->
        <section class="forum-threads">
            <h2>Forum Threads</h2>
            <ul>
                {% for post in posts %}
                    <li>
                        <a href="{{ url_for('bp.post_detail', post_id=post.id) }}">{{ post.title }}</a>
                        <p>Posted by {{ post.user.username }} on {{ post.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
                    </li>
                {% endfor %}
            </ul>
        </section>

        <!-- Live Chat Support -->
        <section id="live-chat">
            <button id="chat-button">Live Chat</button>
            <div id="chat-box" style="display: none;">
                <!-- Chat UI here -->
                <div id="chat-messages">
                    <!-- Messages will appear here -->
                </div>
                <input type="text" id="chat-input" placeholder="Type your message...">
                <button id="send-message">Send</button>
            </div>
        </section>

        <!-- User Badges and Achievements -->
        <section class="user-badges">
            <h2>Your Badges</h2>
            <ul>
                {% for badge in user_badges %}
                    <li>
                        <img src="{{ badge.icon_url }}" alt="{{ badge.name }}" class="badge-icon">
                        <p>{{ badge.name }}</p>
                    </li>
                {% endfor %}
            </ul>
        </section>

        <!-- User Polls and Surveys -->
        <section class="user-polls">
            <h2>Community Polls</h2>
            <ul>
                {% for poll in community_polls %}
                    <li>
                        <h3>{{ poll.question }}</h3>
                        <form method="POST" action="{{ url_for('bp.submit_poll_vote', poll_id=poll.id) }}">
                            {% for option in poll.options %}
                                <label>
                                    <input type="radio" name="poll_option" value="{{ option.id }}">
                                    {{ option.text }}
                                </label>
                            {% endfor %}
                            <button type="submit">Vote</button>
                        </form>
                    </li>
                {% endfor %}
            </ul>
        </section>

        <!-- Threaded Replies -->
        <section class="threaded-replies">
            <h2>Replies</h2>
            <ul>
                {% for reply in threaded_replies %}
                    <li>
                        <p>{{ reply.user.username }}: {{ reply.content }}</p>
                        <button class="btn-reply" data-reply-id="{{ reply.id }}">Reply</button>
                        <div class="reply-form" id="reply-form-{{ reply.id }}" style="display: none;">
                            <textarea placeholder="Write a reply..."></textarea>
                            <button class="btn-submit-reply">Submit</button>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        </section>

        <!-- Forum Analytics Dashboard -->
        <section class="forum-analytics">
            <h2>Forum Analytics</h2>
            <div class="analytics-dashboard">
                <div class="stat">
                    <h3>Total Posts</h3>
                    <p>{{ total_posts }}</p>
                </div>
                <div class="stat">
                    <h3>Total Users</h3>
                    <p>{{ total_users }}</p>
                </div>
                <div class="stat">
                    <h3>Total Comments</h3>
                    <p>{{ total_comments }}</p>
                </div>
                <div class="stat">
                    <h3>Active Discussions</h3>
                    <p>{{ active_discussions }}</p>
                </div>
            </div>
        </section>

        <!-- Event Calendar -->
        <section class="event-calendar">
            <h2>Upcoming Events</h2>
            <div id="calendar"></div>
            <!-- Calendar script here -->
        </section>

        <!-- User Profiles with Activity Feed -->
        <section class="user-profile">
            <h2>{{ user.username }}'s Profile</h2>
            <img src="{{ user.avatar_url }}" alt="{{ user.username }}" class="user-avatar">
            <p>{{ user.bio }}</p>
            <h3>Recent Activity</h3>
            <ul>
                {% for activity in user_activity %}
                    <li>{{ activity.description }} at {{ activity.timestamp.strftime('%Y-%m-%d %H:%M') }}</li>
                {% endfor %}
            </ul>
        </section>

        <!-- Interactive Forum Widgets -->
        <section class="trending-topics">
            <h2>Trending Topics</h2>
            <ul>
                {% for topic in trending_topics %}
                    <li><a href="{{ url_for('bp.topic_posts', topic_id=topic.id) }}">{{ topic.name }}</a></li>
                {% endfor %}
            </ul>
        </section>

        <section class="active-threads">
            <h2>Most Active Threads</h2>
            <ul>
                {% for thread in active_threads %}
                    <li><a href="{{ url_for('bp.thread_detail', thread_id=thread.id) }}">{{ thread.title }}</a></li>
                {% endfor %}
            </ul>
        </section>

        <!-- Rich Text Editing for Posts -->
        <section class="post-editor">
            <h2>Create a New Post</h2>
            <form method="POST" action="{{ url_for('bp.create_post') }}">
                <textarea id="post-content" placeholder="Write your post here..."></textarea>
                <button type="submit">Post</button>
            </form>
            <script src="https://cdn.ckeditor.com/4.16.0/standard/ckeditor.js"></script>
            <script>
                CKEDITOR.replace('post-content');
            </script>
        </section>

        <!-- Customizable User Settings -->
        <section class="user-settings">
            <h2>Settings</h2>
            <form method="POST" action="{{ url_for('bp.update_settings') }}">
                <label for="theme">Theme:</label>
                <select id="theme" name="theme">
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                </select>
                <button type="submit">Save Settings</button>
            </form>
        </section>
    </main>

    <footer>
        <div class="footer-links">
            <p>&copy; 2024 MedHub. All rights reserved.</p>
            <a href="{{ url_for('bp.index') }}">Back Home</a>
            <a href="{{ url_for('bp.privacy_policy') }}">Privacy Policy</a>
            <a href="{{ url_for('bp.terms_of_service') }}">Terms of Service</a>
            <a href="{{ url_for('bp.support') }}">Get Support</a>
            <a href="{{ url_for('bp.view_medical_history') }}">View Medical History</a>
            <a href="{{ url_for('bp.forum') }}">Forums</a>
            <a href="{{ url_for('bp.contact_us') }}">Contact Us</a>
        </div>
    </footer>
    <script> 
        document.addEventListener('DOMContentLoaded', () => {
        initializeChat();
        initializePostEditor();
        initializeUserSettings();
        loadForumThreads();
        initializeEventCalendar();
        initializePolls();
        initializeTrendingTopics();
        initializeActiveThreads();
        loadUserProfile();
        initializeForumAnalytics();
        initializeNotifications();
        initializeSearch();
        initializeTagging();
        initializeVoting();
        initializeModeration();
        initializeReportPost();
        initializeReputationSystem();
        initializePrivateMessaging();
        initializeContentFiltering();
        initializeAttachments();
        initializeBookmarking();
        initializeDarkMode();
    });
    
    function initializeChat() {
        // Same as previous
    }
    
    function initializePostEditor() {
        // Rich text editor initialization
        const editor = new Quill('#post-editor', {
            theme: 'snow',
            modules: {
                toolbar: true
            }
        });
    
        editor.on('text-change', () => {
            localStorage.setItem('draftPost', editor.root.innerHTML);
        });
    
        const postForm = document.getElementById('post-form');
        postForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const content = editor.root.innerHTML;
            fetch('/api/posts', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ content })
            }).then(response => response.json())
              .then(data => {
                  editor.root.innerHTML = '';
                  localStorage.removeItem('draftPost');
              });
        });
    
        window.addEventListener('load', () => {
            const draftPost = localStorage.getItem('draftPost');
            if (draftPost) {
                editor.root.innerHTML = draftPost;
            }
        });
    }
    
    function initializeUserSettings() {
        // User settings
    }
    
    function loadForumThreads() {
        // Load forum threads
    }
    
    function initializeEventCalendar() {
        // Calendar
    }
    
    function initializePolls() {
        // Polls
    }
    
    function initializeTrendingTopics() {
        // Trending topics
    }
    
    function initializeActiveThreads() {
        // Active threads
    }
    
    function loadUserProfile() {
        // User profile
    }
    
    function initializeForumAnalytics() {
        // Forum analytics
    }
    
    function initializeNotifications() {
        const notificationsContainer = document.getElementById('notifications');
        if (notificationsContainer) {
            // Fetch notifications
            fetch('/api/notifications')
                .then(response => response.json())
                .then(notifications => {
                    notifications.forEach(notification => {
                        const notificationElement = document.createElement('li');
                        notificationElement.textContent = notification.message;
                        notificationsContainer.appendChild(notificationElement);
                    });
                });
        }
    }
    
    function initializeSearch() {
        const searchInput = document.getElementById('search-input');
        const searchResults = document.getElementById('search-results');
    
        if (searchInput) {
            searchInput.addEventListener('input', () => {
                const query = searchInput.value;
                fetch(`/api/search?q=${encodeURIComponent(query)}`)
                    .then(response => response.json())
                    .then(results => {
                        searchResults.innerHTML = '';
                        results.forEach(result => {
                            const resultElement = document.createElement('li');
                            resultElement.innerHTML = `<a href="/forum/thread/${result.id}">${result.title}</a>`;
                            searchResults.appendChild(resultElement);
                        });
                    });
            });
        }
    }
    
    function initializeTagging() {
        const taggingInput = document.getElementById('tagging-input');
        if (taggingInput) {
            taggingInput.addEventListener('input', () => {
                const query = taggingInput.value;
                fetch(`/api/users/search?q=${encodeURIComponent(query)}`)
                    .then(response => response.json())
                    .then(users => {
                        const tagSuggestions = document.getElementById('tag-suggestions');
                        tagSuggestions.innerHTML = '';
                        users.forEach(user => {
                            const userElement = document.createElement('div');
                            userElement.textContent = user.username;
                            userElement.addEventListener('click', () => {
                                taggingInput.value = `@${user.username}`;
                                tagSuggestions.innerHTML = '';
                            });
                            tagSuggestions.appendChild(userElement);
                        });
                    });
            });
        }
    }
    
    function initializeVoting() {
        document.querySelectorAll('.vote-button').forEach(button => {
            button.addEventListener('click', () => {
                const postId = button.dataset.postId;
                const voteType = button.dataset.voteType;
                fetch(`/api/posts/${postId}/vote`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ voteType })
                }).then(response => response.json())
                  .then(data => {
                      // Update UI with new vote counts
                  });
            });
        });
    }
    
    function initializeModeration() {
        const moderationButtons = document.querySelectorAll('.moderation-button');
        moderationButtons.forEach(button => {
            button.addEventListener('click', () => {
                const postId = button.dataset.postId;
                const action = button.dataset.action;
                fetch(`/api/moderation/${action}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ postId })
                }).then(response => response.json())
                  .then(data => {
                      // Update UI based on action
                  });
            });
        });
    }
    
    function initializeReportPost() {
        const reportButtons = document.querySelectorAll('.report-button');
        reportButtons.forEach(button => {
            button.addEventListener('click', () => {
                const postId = button.dataset.postId;
                fetch('/api/posts/report', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ postId })
                }).then(response => response.json())
                  .then(data => {
                      // Notify user of report status
                  });
            });
        });
    }
    
    function initializeReputationSystem() {
        const reputationElement = document.getElementById('user-reputation');
        if (reputationElement) {
            fetch('/api/user/reputation')
                .then(response => response.json())
                .then(reputation => {
                    reputationElement.textContent = `Reputation: ${reputation.score}`;
                });
        }
    }
    
    function initializePrivateMessaging() {
        const pmButton = document.getElementById('pm-button');
        const pmBox = document.getElementById('pm-box');
        const pmInput = document.getElementById('pm-input');
        const sendPmButton = document.getElementById('send-pm');
        const pmMessages = document.getElementById('pm-messages');
    
        pmButton.addEventListener('click', () => {
            pmBox.style.display = pmBox.style.display === 'none' ? 'block' : 'none';
        });
    
        sendPmButton.addEventListener('click', () => {
            const message = pmInput.value;
            if (message.trim()) {
                fetch('/api/private-messages', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                }).then(response => response.json())
                  .then(data => {
                      pmMessages.innerHTML += `<div>${data.message}</div>`;
                      pmInput.value = '';
                  });
            }
        });
    }
    
    function initializeContentFiltering() {
        const filterSelect = document.getElementById('filter-select');
        filterSelect.addEventListener('change', () => {
            const filter = filterSelect.value;
            fetch(`/api/posts?filter=${encodeURIComponent(filter)}`)
                .then(response => response.json())
                .then(posts => {
                    const postsContainer = document.getElementById('posts-container');
                    postsContainer.innerHTML = '';
                    posts.forEach(post => {
                        const postElement = document.createElement('li');
                        postElement.innerHTML = `<a href="/forum/thread/${post.id}">${post.title}</a>`;
                        postsContainer.appendChild(postElement);
                    });
                });
        });
    }
    function initializeAttachments() {
        const attachmentInput = document.getElementById('attachment-input');
        const attachmentList = document.getElementById('attachment-list');
        
        attachmentInput.addEventListener('change', (event) => {
            const files = event.target.files;
            Array.from(files).forEach(file => {
                const listItem = document.createElement('li');
                listItem.textContent = file.name;
                attachmentList.appendChild(listItem);
    
                // Optionally, you can upload the file to the server here
                const formData = new FormData();
                formData.append('file', file);
                fetch('/api/attachments', {
                    method: 'POST',
                    body: formData
                }).then(response => response.json())
                  .then(data => {
                      // Handle successful upload
                  });
            });
        });
    }
    
    function initializeBookmarking() {
        document.querySelectorAll('.bookmark-button').forEach(button => {
            button.addEventListener('click', () => {
                const postId = button.dataset.postId;
                fetch(`/api/posts/${postId}/bookmark`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                }).then(response => response.json())
                  .then(data => {
                      // Update UI to reflect bookmarking status
                  });
            });
        });
    }
    
    function initializeDarkMode() {
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        darkModeToggle.addEventListener('change', () => {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        });
    
        window.addEventListener('load', () => {
            const darkMode = localStorage.getItem('darkMode') === 'true';
            if (darkMode) {
                document.body.classList.add('dark-mode');
                darkModeToggle.checked = true;
            }
        });
    }
    
    // Real-time notifications
    function initializeRealTimeNotifications() {
        const notificationsSocket = new WebSocket('ws://yourserver.com/notifications');
        
        notificationsSocket.onmessage = (event) => {
            const notification = JSON.parse(event.data);
            const notificationElement = document.createElement('li');
            notificationElement.textContent = notification.message;
            document.getElementById('notifications').appendChild(notificationElement);
        };
    }
    
    // Function to load user profile data
    function loadUserProfile() {
        fetch('/api/user/profile')
            .then(response => response.json())
            .then(profile => {
                document.getElementById('profile-name').textContent = profile.name;
                document.getElementById('profile-email').textContent = profile.email;
                // Other profile fields...
            });
    }
    
    // Function to initialize forum analytics dashboard
    function initializeForumAnalytics() {
        fetch('/api/analytics')
            .then(response => response.json())
            .then(analytics => {
                document.getElementById('total-posts').textContent = `Total Posts: ${analytics.totalPosts}`;
                document.getElementById('total-users').textContent = `Total Users: ${analytics.totalUsers}`;
                // Other analytics...
            });
    }
    </script>
</body>
</html>
